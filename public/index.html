<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAF Prototype - Defensive Security System</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f9; /* Professional Light Background */
        }
        .container {
            max-width: 900px;
        }
        .card-header {
            font-weight: bold;
            font-size: 1.1em;
        }
        /* Custom alert styles (using status colors) */
        .alert.safe { 
            background-color: #d1e7dd; /* Success Green */
            color: #0f5132; 
            border-color: #badbcc; 
        }
        .alert.blocked { 
            background-color: #f8d7da; /* Danger Red */
            color: #842029; 
            border-color: #f5c6cb; 
            font-weight: bold; 
        }
        .alert.alert-warning {
            background-color: #fff3cd;
            color: #664d03;
            border-color: #ffecb5;
        }
        /* Custom button colors (using serious security context) */
        .btn-custom-sqli {
            background-color: #dc3545; /* Bootstrap Danger */
            border-color: #dc3545;
            color: white;
        }
        .btn-custom-sqli:hover {
            background-color: #c82333;
            border-color: #c82333;
        }
        .btn-custom-xss {
            background-color: #ffc107; /* Bootstrap Warning/Secondary Attack */
            border-color: #ffc107;
            color: #212529;
        }
        .btn-custom-xss:hover {
            background-color: #e0a800;
            border-color: #e0a800;
        }
        .btn-custom-safe {
            background-color: #198754; /* Bootstrap Success */
            border-color: #198754;
            color: white;
        }
        .btn-custom-safe:hover {
            background-color: #157347;
            border-color: #157347;
        }

    </style>
</head>
<body class="bg-light">
    
    <div class="container mt-5">
        <h1 class="text-center mb-5 text-dark display-5">‚öôÔ∏è Web Application Firewall Prototype</h1>
        <p class="text-center text-muted lead">A defensive security system demonstrating the identification and mitigation of common web vulnerabilities.</p>
        
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark text-white">1. Input Sanitization Assessment</div>
            <div class="card-body">
                <p class="card-text">Submit any string for analysis. The WAF will inspect the input against known malicious signatures.</p>
                <div class="input-group mb-3">
                    <input type="text" id="userInput" class="form-control form-control-lg" placeholder="Enter query string for WAF assessment..." autofocus>
                    <button class="btn btn-primary btn-lg" type="button" onclick="sendToWAF()">Execute Assessment</button>
                </div>
            </div>
        </div>

        <div class="card shadow-sm mb-4">
            <div class="card-header bg-secondary text-white">2. Vulnerability Demonstration Payloads</div>
            <div class="card-body">
                <p class="card-text text-muted">Use these pre-set payloads to demonstrate the WAF's defensive capabilities against specific attack vectors:</p>
                <div class="d-grid gap-2 d-md-flex justify-content-center">
                    <button class="btn btn-custom-sqli btn-lg me-md-2 mb-2 mb-md-0" onclick="runAttack('SQL Injection (Tautology)', '\' OR 1=1 --')">
                        <i class="bi bi-shield-fill-exclamation"></i> Test SQLi
                    </button>
                    <button class="btn btn-custom-xss btn-lg me-md-2 mb-2 mb-md-0" onclick="runAttack('Cross-Site Scripting (Reflective)', '<script>document.body.innerHTML = \'Attack Successful\';</script>')">
                        <i class="bi bi-code-slash"></i> Test XSS
                    </button>
                    <button class="btn btn-custom-safe btn-lg" onclick="runAttack('Baseline Safe Query', 'Fetch all products by name.')">
                        <i class="bi bi-check-circle-fill"></i> Test Safe Input
                    </button>
                </div>
            </div>
        </div>

        <div class="card shadow-lg">
            <div class="card-header bg-dark text-white">3. System Response Log</div>
            <div class="card-body">
                <div id="output" class="alert alert-info mb-0">... Awaiting Input ...</div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <script>
        // ***************************************************************
        // NOTE: The WAF_API_URL is expected to be securely hosted on Render.
        // ***************************************************************
        const WAF_API_URL = 'https://waf-prototype-fy.onrender.com/api/check'; // Your Render URL here!

        // Function to run a pre-defined attack payload
        function runAttack(name, payload) {
            document.getElementById('userInput').value = payload;
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = `<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Initiating simulation: <strong>${name}</strong> with payload: <code>${escapeHTML(payload)}</code>`;
            outputDiv.className = 'alert alert-warning';
            
            // Automatically trigger the test 50ms later to allow UI update
            setTimeout(sendToWAF, 50);
        }

        async function sendToWAF() {
            const userInput = document.getElementById('userInput').value;
            const outputDiv = document.getElementById('output');
            
            outputDiv.innerHTML = `<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Transmitting request to WAF...`;
            outputDiv.className = 'alert alert-info';

            try {
                const response = await fetch(WAF_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ userInput: userInput })
                });

                const data = await response.json();
                
                if (data.status === 'blocked') {
                    outputDiv.className = 'alert blocked';
                    outputDiv.innerHTML = `‚ùå <strong>ACCESS DENIED (403):</strong> ${data.message} <br> <em>Observed Malicious Payload:</em> <code>${escapeHTML(userInput)}</code>`;
                } else if (data.status === 'safe') {
                    outputDiv.className = 'alert safe';
                    outputDiv.innerHTML = `‚úÖ <strong>ACCESS GRANTED (200):</strong> ${data.message}`;
                } else {
                    outputDiv.className = 'alert alert-danger';
                    outputDiv.innerHTML = `‚ö†Ô∏è <strong>System Error:</strong> ${data.message || 'Unknown server response'}`;
                }

            } catch (error) {
                outputDiv.className = 'alert blocked';
                outputDiv.innerHTML = `üõë <strong>NETWORK FAILURE:</strong> Could not establish connection with the WAF API. <br>Ensure the Render backend service is operational and the URL is correct. <br><em>Error:</em> ${error.message}`;
                console.error('Fetch error:', error);
            }
        }

        // Helper function to escape HTML for display, preventing self-XSS in the log
        function escapeHTML(str) {
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML;
        }
    </script>
</body>
</html>
