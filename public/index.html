<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAF SENTINEL | Defensive Security System</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- GLOBAL VARIABLES & RESET --- */
        :root {
            --neon-blue: #00f3ff;
            --neon-green: #0aff0a;
            --neon-red: #ff003c;
            --neon-yellow: #ffee00;
            --bg-dark: #050505;
            --glass-bg: rgba(20, 20, 20, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--bg-dark);
            color: #e0e0e0;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        /* --- BACKGROUND MATRIX EFFECT --- */
        canvas#matrixCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Behind everything */
        }

        /* --- TYPOGRAPHY & HEADERS --- */
        h1, h5 {
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .main-title {
            text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue);
            animation: flicker 3s infinite alternate;
        }

        /* --- GLASSMORPHISM CARDS --- */
        .cyber-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-left: 4px solid var(--neon-blue);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border-radius: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 2rem;
        }

        .cyber-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 40px 0 rgba(0, 243, 255, 0.15);
        }

        .card-header {
            background: transparent;
            border-bottom: 1px solid var(--glass-border);
            color: var(--neon-blue);
            font-weight: 700;
            padding: 15px 20px;
        }

        /* --- INPUTS --- */
        .cyber-input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--neon-blue);
            color: white;
            font-family: 'JetBrains Mono', monospace;
        }
        .cyber-input:focus {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            box-shadow: 0 0 15px var(--neon-blue);
            border-color: var(--neon-blue);
        }

        /* --- BUTTONS --- */
        .btn-cyber-primary {
            background: transparent;
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            text-transform: uppercase;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.3s;
        }
        .btn-cyber-primary:hover {
            background: var(--neon-blue);
            color: black;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        .btn-attack-sqli {
            border: 1px solid var(--neon-red);
            color: var(--neon-red);
            background: rgba(255, 0, 60, 0.05);
        }
        .btn-attack-sqli:hover {
            background: var(--neon-red);
            color: white;
            box-shadow: 0 0 20px var(--neon-red);
        }

        .btn-attack-xss {
            border: 1px solid var(--neon-yellow);
            color: var(--neon-yellow);
            background: rgba(255, 238, 0, 0.05);
        }
        .btn-attack-xss:hover {
            background: var(--neon-yellow);
            color: black;
            box-shadow: 0 0 20px var(--neon-yellow);
        }

        .btn-safe {
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            background: rgba(10, 255, 10, 0.05);
        }
        .btn-safe:hover {
            background: var(--neon-green);
            color: black;
            box-shadow: 0 0 20px var(--neon-green);
        }

        /* --- TERMINAL OUTPUT --- */
        .terminal-window {
            background-color: #0d0d0d;
            border: 1px solid #333;
            border-radius: 5px;
            font-family: 'JetBrains Mono', monospace;
            padding: 0;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,1);
        }
        .terminal-header {
            background: #1a1a1a;
            padding: 5px 10px;
            font-size: 0.8rem;
            color: #666;
            display: flex;
            gap: 5px;
        }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot-red { background: #ff5f56; }
        .dot-yellow { background: #ffbd2e; }
        .dot-green { background: #27c93f; }

        #output {
            padding: 20px;
            min-height: 150px;
            color: #ccc;
            font-size: 0.9rem;
        }

        /* Log Status Colors */
        .log-blocked { color: var(--neon-red); text-shadow: 0 0 5px var(--neon-red); }
        .log-safe { color: var(--neon-green); text-shadow: 0 0 5px var(--neon-green); }
        .log-process { color: var(--neon-yellow); }
        .log-info { color: var(--neon-blue); }

        /* Animations */
        @keyframes flicker {
            0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% { opacity: 1; }
            20%, 24%, 55% { opacity: 0.4; }
        }
        
        .cursor {
            display: inline-block;
            width: 8px;
            background: var(--neon-green);
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>

    <div class="container mt-5 mb-5 relative-z">
        <div class="text-center mb-5">
            <h1 class="display-4 main-title fw-bold"><i class="bi bi-shield-lock-fill"></i> WAF SENTINEL</h1>
            <p class="lead" style="color: var(--neon-blue);">Intelligent Threat Detection & Mitigation System</p>
            <div class="badge bg-dark border border-light mt-2">v1.0.4 PROTOTYPE</div>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-lg-10">

                <div class="card cyber-card">
                    <div class="card-header">
                        <i class="bi bi-terminal-fill me-2"></i> TRAFFIC INSPECTOR
                    </div>
                    <div class="card-body">
                        <p class="text-muted small mb-3">Enter a payload to simulate an HTTP request interception.</p>
                        <div class="input-group mb-3">
                            <span class="input-group-text bg-dark text-light border-secondary" style="border-right:none;">root@waf:~#</span>
                            <input type="text" id="userInput" class="form-control form-control-lg cyber-input" placeholder="SELECT * FROM users..." autofocus>
                            <button class="btn btn-cyber-primary px-4" type="button" onclick="sendToWAF()">
                                <i class="bi bi-play-fill"></i> ANALYZE
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card cyber-card">
                    <div class="card-header">
                        <i class="bi bi-lightning-charge-fill me-2"></i> THREAT SIMULATION LIBRARY
                    </div>
                    <div class="card-body">
                        <p class="text-muted small mb-3">Deploy pre-configured attack vectors to test defensive rules.</p>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <button class="btn btn-attack-sqli w-100 py-3" onclick="runAttack('SQL Injection', '\' OR 1=1 --')">
                                    <div class="fs-4"><i class="bi bi-database-fill-x"></i></div>
                                    <div>SQL Injection</div>
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-attack-xss w-100 py-3" onclick="runAttack('XSS Attack', '<script>alert(\'Hacked\')</script>')">
                                    <div class="fs-4"><i class="bi bi-code-square"></i></div>
                                    <div>Cross-Site Scripting</div>
                                </button>
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-safe w-100 py-3" onclick="runAttack('Legitimate Request', 'Search for laptop chargers')">
                                    <div class="fs-4"><i class="bi bi-shield-check"></i></div>
                                    <div>Legitimate Traffic</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card cyber-card" style="border-left-color: var(--neon-green);">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-activity me-2"></i> SECURITY EVENT LOGS</span>
                        <span class="badge bg-dark border border-secondary text-muted">LIVE MONITORING</span>
                    </div>
                    <div class="card-body p-0">
                        <div class="terminal-window">
                            <div class="terminal-header">
                                <span class="dot dot-red"></span>
                                <span class="dot dot-yellow"></span>
                                <span class="dot dot-green"></span>
                                <span class="ms-2">bash - system_monitor.sh</span>
                            </div>
                            <div id="output">
                                <div class="mb-2"><span class="text-success">‚ûú</span> System initialized...</div>
                                <div class="mb-2"><span class="text-success">‚ûú</span> WAF Engine: <span class="text-primary">ONLINE</span></div>
                                <div class="mb-2"><span class="text-success">‚ûú</span> Awaiting traffic input<span class="cursor">&nbsp;</span></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ***************************************************************
        // MATRIX BACKGROUND EFFECT
        // ***************************************************************
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas full screen
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        const katakana = '„Ç¢„Ç°„Ç´„Çµ„Çø„Éä„Éè„Éû„É§„É£„É©„ÉØ„Ç¨„Ç∂„ÉÄ„Éê„Éë„Ç§„Ç£„Ç≠„Ç∑„ÉÅ„Éã„Éí„Éü„É™„É∞„ÇÆ„Ç∏„ÉÇ„Éì„Éî„Ç¶„Ç•„ÇØ„Çπ„ÉÑ„Éå„Éï„É†„É¶„É•„É´„Ç∞„Ç∫„Éñ„ÉÖ„Éó„Ç®„Çß„Ç±„Çª„ÉÜ„Éç„Éò„É°„É¨„É±„Ç≤„Çº„Éá„Éô„Éö„Ç™„Ç©„Ç≥„ÇΩ„Éà„Éé„Éõ„É¢„É®„Éß„É≠„É≤„Ç¥„Çæ„Éâ„Éú„Éù„É¥„ÉÉ„É≥0123456789';
        const latin = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const nums = '0123456789';
        const alphabet = katakana + latin + nums;

        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = [];

        for(let x = 0; x < columns; x++) {
            drops[x] = 1;
        }

        function drawMatrix() {
            ctx.fillStyle = 'rgba(5, 5, 5, 0.05)'; // Trail effect
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = '#0F0'; // Green text
            ctx.font = fontSize + 'px monospace';

            for(let i = 0; i < drops.length; i++) {
                const text = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);

                if(drops[i] * fontSize > canvas.height && Math.random() > 0.975)
                    drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 30);


        // ***************************************************************
        // WAF LOGIC & UI HANDLING
        // ***************************************************************
        
        const WAF_API_URL = 'https://waf-prototype-fy.onrender.com/api/check'; 

        // Helper: Get Timestamp
        function getTime() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', { hour12: false }) + "." + now.getMilliseconds();
        }

        // Helper: Typewriter Effect for Logs
        function typeToLog(htmlContent, className) {
            const outputDiv = document.getElementById('output');
            // Remove existing blinking cursor to append new line
            const cursors = outputDiv.getElementsByClassName('cursor');
            while(cursors[0]) { cursors[0].parentNode.removeChild(cursors[0]); }

            const newLine = document.createElement('div');
            newLine.className = `mb-2 ${className}`;
            newLine.innerHTML = `<span class="text-secondary">[${getTime()}]</span> ${htmlContent} <span class="cursor">&nbsp;</span>`;
            
            outputDiv.appendChild(newLine);
            outputDiv.scrollTop = outputDiv.scrollHeight; // Auto scroll
        }

        function runAttack(name, payload) {
            document.getElementById('userInput').value = payload;
            typeToLog(`Initiating attack simulation: <strong>${name}</strong>...`, 'log-info');
            setTimeout(sendToWAF, 600); // Small delay for realism
        }

        async function sendToWAF() {
            const userInput = document.getElementById('userInput').value;
            
            if (!userInput) {
                typeToLog(`Error: Input buffer empty.`, 'text-muted');
                return;
            }

            // Visual Processing
            typeToLog(`Transmitting payload packet (${userInput.length} bytes)...`, 'log-process');
            
            try {
                const response = await fetch(WAF_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userInput: userInput })
                });

                const data = await response.json();
                
                // Simulate processing time for effect
                setTimeout(() => {
                    if (data.status === 'blocked') {
                        typeToLog(`<strong>‚õî BLOCK ACTION TRIGGERED</strong>`, 'log-blocked');
                        typeToLog(`Reason: ${data.message}`, 'log-blocked');
                        typeToLog(`Signature Match: <u>${escapeHTML(userInput)}</u>`, 'text-secondary small');
                    } else if (data.status === 'safe') {
                        typeToLog(`<strong>‚úÖ TRAFFIC ALLOWED</strong>`, 'log-safe');
                        typeToLog(`Analysis: No malicious signatures detected.`, 'text-light');
                    } else {
                        typeToLog(`‚ö†Ô∏è SYSTEM WARNING: ${data.message}`, 'text-warning');
                    }
                }, 400);

            } catch (error) {
                typeToLog(`üõë CONNECTION FAILURE: WAF API Unreachable.`, 'log-blocked');
                console.error(error);
            }
        }

        function escapeHTML(str) {
            return str.replace(/[&<>'"]/g, 
                tag => ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    "'": '&#39;',
                    '"': '&quot;'
                }[tag]));
        }
    </script>
</body>
</html>
